// TODO -- cannot flush global report variables yet on Wizard target
// TODO -- support pulling fname on Wizard target!
report map<(u32, u32, i32), i32> count;

wasm::br:before /
    imm0 == 31 ||
    imm0 == 32
/ {
  // branch always taken for `br`
  // count stores an array of counters
  count[(fid, pc, 1)]++;
}

wasm::br_if:before /
    imm0 == 31 ||
    imm0 == 32
/ {
  // which branch was taken?
  i32 index;
  index = arg0 != 0 ? 1 : 0;

  // count stores an array of counters
  count[(fid, pc, index)]++;
}

wasm::br_table:before /
    imm0 == 31 ||
    imm0 == 32
/ {
  // which branch was taken?
  i32 index;
  index = arg0 < (num_targets - 1) ? targets[arg0] : default_target;

  // count stores an array of counters
  count[(fid, pc, index)]++;
}
